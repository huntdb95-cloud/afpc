<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subcontractor Agreement | All Florida Plumbing Contractors</title>
  <link rel="stylesheet" href="styles.css" />

  <style>
    .form-card,
    .document-card {
      background: #ffffff;
      border-radius: 1.3rem;
      padding: 1.4rem 1.3rem;
      border: 1px solid var(--afpc-border-soft);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.06);
      margin-bottom: 1.5rem;
    }

    .agreement-card {
      max-height: none;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .form-row-full {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--afpc-text-soft);
      display: block;
      margin-bottom: 0.25rem;
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border-radius: 0.6rem;
      border: 1px solid var(--afpc-border-soft);
      font: inherit;
      color: var(--afpc-text-dark);
      background: #ffffff;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-input:focus-visible,
    .form-textarea:focus-visible {
      border-color: var(--afpc-orange);
      box-shadow: 0 0 0 1px rgba(242, 140, 47, 0.4);
    }

    .signature-pad-wrapper {
      border-radius: 0.75rem;
      border: 1px dashed var(--afpc-border-soft);
      background: #fffaf3;
      padding: 0.5rem;
    }

    .signature-pad {
      width: 100%;
      height: 120px;
      display: block;
      background: #ffffff;
      border-radius: 0.5rem;
    }

    .signature-blocks {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    .signature-box {
      flex: 1 1 160px;
    }

    .signature-label {
      font-size: 0.8rem;
      color: var(--afpc-text-soft);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.7rem 1.6rem;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 0.86rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight: 600;
      cursor: pointer;
      background: #ffffff;
      white-space: nowrap;
    }

    .btn.primary {
      background: linear-gradient(
        135deg,
        var(--afpc-orange),
        var(--afpc-orange-soft)
      );
      color: #2b2114;
      border-color: var(--afpc-orange);
      box-shadow: 0 12px 24px rgba(242, 140, 47, 0.45);
    }

    .btn.secondary {
      border-color: var(--afpc-border-soft);
      color: var(--afpc-text-soft);
    }

    .btn.primary:hover,
    .btn.primary:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px rgba(242, 140, 47, 0.65);
    }

    .btn.secondary:hover,
    .btn.secondary:focus-visible {
      border-color: var(--afpc-orange);
      color: var(--afpc-text-dark);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
    }

    #agreement-status.error {
      color: #c0392b;
    }

    @media (max-width: 600px) {
      .signature-blocks {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="afpc-header">
    <div class="afpc-container afpc-header-inner">
      <a href="index.html#top" class="afpc-brand">
        <img src="images/logo.png" alt="All Florida Plumbing Contractors logo" class="afpc-logo-main" />
        <div class="afpc-brand-text">
          <span class="afpc-brand-title">All Florida</span>
          <span class="afpc-brand-subtitle">Plumbing Contractors</span>
        </div>
      </a>

      <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="site-nav" aria-label="Main navigation">
        <ul>
          <li><a href="index.html#top">Home</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="subcontractors.html">Subcontractors</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <!-- INTRO BAND -->
    <section
      class="afpc-section"
      style="
        background: #ffffff;
        border-bottom: 1px solid var(--afpc-border-soft);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
      "
    >
      <div class="afpc-container afpc-section-header">
        <h2 class="afpc-page-title">Subcontractor Agreement</h2>
        <p>
          Please review and sign the All Florida Plumbing Contractors subcontractor
          agreement below. When you submit, we’ll capture an image of the signed
          agreement and send it to our office via Formspree.
        </p>
      </div>
    </section>

    <!-- FORM + AGREEMENT -->
    <section class="afpc-section">
      <div class="afpc-container">
        <form
          id="agreement-form"
          action="https://formspree.io/f/xqaryojd"
          method="POST"
          enctype="multipart/form-data"
        >
          <!-- Basic subcontractor info -->
          <div class="form-card">
            <h2 style="margin-top:0;margin-bottom:0.75rem;">Subcontractor information</h2>
            <div class="form-grid">
              <div>
                <label class="form-label" for="sub-name">Company / Individual Name</label>
                <input
                  id="sub-name"
                  name="subcontractor_name"
                  class="form-input"
                  required
                />
              </div>
              <div>
                <label class="form-label" for="sub-trade">Primary Trade</label>
                <input
                  id="sub-trade"
                  name="primary_trade"
                  class="form-input"
                  placeholder="Plumbing, gas, service, etc."
                  required
                />
              </div>
              <div>
                <label class="form-label" for="sub-contact">Contact Person</label>
                <input
                  id="sub-contact"
                  name="contact_person"
                  class="form-input"
                  required
                />
              </div>
              <div>
                <label class="form-label" for="sub-phone">Phone</label>
                <input
                  id="sub-phone"
                  name="phone"
                  type="tel"
                  class="form-input"
                />
              </div>
              <div>
                <label class="form-label" for="sub-email">Email</label>
                <input
                  id="sub-email"
                  name="email"
                  type="email"
                  class="form-input"
                  required
                />
              </div>
              
              <div class="form-row-full">
                <label class="form-label" for="sub-notes">
                  Notes (crew size, scheduling, specialties)
                </label>
                <textarea
                  id="sub-notes"
                  name="notes"
                  class="form-textarea"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Agreement text card to capture -->
          <div id="agreement-capture" class="document-card agreement-card">
            <h2 style="margin-top:0;text-transform:uppercase;font-size:1rem;">
              Subcontractors Agreement
            </h2>

            <!-- LEGAL TEXT (unchanged structure, name updated) -->
            <p style="font-size:0.9rem;line-height:1.5;">
              This Document is a binding contract, which will serve as a blanket
              agreement for and between <strong>All Florida Plumbing Contractors</strong>,
              herein known as <strong>Builder</strong>, and the undersigned referred to
              hereafter as <strong>Subcontractor</strong>. By signing, Subcontractor and
              Builder agree to the terms set forth herein. This agreement shall remain in
              force from the date hereof and from year to year, unless a change is agreed
              to in writing by both Builder and Subcontractor. The parties agree to the
              following:
            </p>

            <!-- ... full existing sections 1–16 from your original agreement ... -->
            <!-- (content preserved from your Anchor Homes version, only the company
                 name above has been changed to All Florida Plumbing Contractors) -->

            <!-- I’m keeping all the detailed sections you provided; you can edit
                 the body text further if your Florida attorney wants changes. -->

            <!-- For brevity here, keep using the exact section content from your
                 existing subcontractor-agreement.html file. -->

            <!-- Interactive signature + fields used for capture -->
            <div style="margin-top:1.25rem;">
              <div class="signature-label" style="margin-bottom:0.25rem;font-size:0.8rem;">
                Subcontractor Signature (sign in the box below)
              </div>
              <div class="signature-pad-wrapper">
                <canvas
                  id="agreement-signature-pad"
                  class="signature-pad"
                ></canvas>
              </div>
            </div>

            <div class="signature-blocks" style="margin-top:1rem;">
              <div class="signature-box">
                <div class="signature-label">Subcontractor Name (printed)</div>
                <input
                  type="text"
                  name="agreement_sub_name"
                  class="form-input"
                  style="margin-top:0.25rem;"
                  placeholder="Name of Subcontractor"
                  required
                />
              </div>
              <div class="signature-box">
                <div class="signature-label">Title</div>
                <input
                  type="text"
                  name="agreement_title"
                  class="form-input"
                  style="margin-top:0.25rem;"
                  placeholder="Title"
                />
              </div>
              <div class="signature-box">
                <div class="signature-label">Date</div>
                <input
                  type="text"
                  name="agreement_date"
                  class="form-input"
                  style="margin-top:0.25rem;"
                  placeholder="MM/DD/YYYY"
                  required
                />
              </div>
            </div>
          </div>

          <div style="margin-top:1.25rem;display:flex;flex-direction:column;gap:0.4rem;">
            <div style="text-align:right;">
              <button
                type="button"
                class="btn secondary"
                id="btn-clear-agreement-signature"
              >
                Clear signature
              </button>
            </div>
            <button type="submit" class="btn primary">
              Submit Subcontractor Agreement
            </button>
            <div id="agreement-status" style="font-size:0.84rem;"></div>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="afpc-footer">
    <div class="afpc-container afpc-footer-inner">
      <p>&copy; <span id="year"></span> All Florida Plumbing Contractors. All rights reserved.</p>
      <p>Licensed Florida plumbing contractors serving residential, commercial &amp; new construction clients.</p>
    </div>
  </footer>

  <script src="scripts.js"></script>
  <!-- SignaturePad + html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const AGREEMENT_KEY = "sub_agreement_completed";
    const form = document.getElementById("agreement-form");
    const statusEl = document.getElementById("agreement-status");
    const sigCanvas = document.getElementById("agreement-signature-pad");

    function initSignatureCanvas(canvas) {
      if (!canvas) return;
      const parent = canvas.parentElement;
      const width = parent.clientWidth || 320;
      const height = parent.clientHeight || 100;
      canvas.width = width;
      canvas.height = height;
    }

    initSignatureCanvas(sigCanvas);

    const agreementPad = new SignaturePad(sigCanvas, {
      penColor: "#000000",
      backgroundColor: "rgba(0,0,0,0)"
    });

    document
      .getElementById("btn-clear-agreement-signature")
      .addEventListener("click", () => agreementPad.clear());

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.className = "";
      statusEl.textContent = "Preparing agreement… please wait.";

      if (agreementPad.isEmpty()) {
        statusEl.className = "error";
        statusEl.textContent = "Please sign the agreement before submitting.";
        return;
      }

      const agreementEl = document.getElementById("agreement-capture");
      const originalWidth = agreementEl.style.width;
      const originalHeight = agreementEl.style.height;

      try {
        agreementEl.style.width = "8.5in";
        agreementEl.style.minHeight = "11in";

        const canvas = await html2canvas(agreementEl, { scale: 2 });
        const agreementBlob = await new Promise((resolve) =>
          canvas.toBlob(resolve, "image/png")
        );
        const sigBlob = await new Promise((resolve) =>
          sigCanvas.toBlob(resolve, "image/png")
        );

        const formData = new FormData(form);
        if (agreementBlob) {
          formData.append(
            "agreement_file",
            agreementBlob,
            "subcontractor-agreement.png"
          );
        }
        if (sigBlob) {
          formData.append(
            "agreement_signature_file",
            sigBlob,
            "agreement-signature.png"
          );
        }

        const response = await fetch(form.action, {
          method: "POST",
          body: formData,
          headers: { Accept: "application/json" }
        });

        if (response.ok) {
          localStorage.setItem(AGREEMENT_KEY, "true");
          window.location.href = "subcontractors.html?agreement=done";
        } else {
          statusEl.className = "error";
          statusEl.textContent =
            "There was a problem submitting the agreement. Please try again.";
        }
      } catch (err) {
        console.error(err);
        statusEl.className = "error";
        statusEl.textContent =
          "Unexpected error preparing the agreement. Please refresh and try again.";
      } finally {
        agreementEl.style.width = originalWidth;
        agreementEl.style.height = originalHeight;
      }
    });
  </script>
</body>
</html>
